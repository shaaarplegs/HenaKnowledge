{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nexports.__esModule = true;\nexports.svgStrToDataUrl = exports.logCharts = exports.extractNonDataImageFromSVG = exports.parseUrl = exports.extractNonDataURLFromSVG = exports.removeImagesWithNonDataURL = exports.hasUndownloadableImage = exports.replaceImagesWithNonDataUrl = exports.embedImagesWithNonDataURL = exports.makeImageUrlsAbsolute = exports.isCacheAllImagesCompleted = exports.getImageCachedDetails = exports.cacheAllImages = exports.objCacheFunctions = exports.createExportActionOldString = exports.LOGMODE = exports.EXPORTFORMAT = exports.EXPORTMODE = exports.EXPORTACTION = void 0;\n\nvar _libSvgToCanvas = require(\"./lib-svg-to-canvas\");\n\nvar _ajax = _interopRequireDefault(require(\"@fusioncharts/core/src/ajax\"));\n\nvar _lib = require(\"@fusioncharts/core/src/lib\");\n\nvar extractNonDataImageFromSVG = function extractNonDataImageFromSVG(svgStr) {\n  var URLRegex, dataURIRegex, arrImageStr, match, tmpImageStr, tmpUrl;\n  URLRegex = /(<image [^\\>]*href=[\"']([^\\>'\"]*)[\"'][^\\>]*\\>)/g;\n  dataURIRegex = /^\\s*data:([a-z]+\\/[a-z]+(;[a-z\\-]+\\=[a-z\\-]+)?)?(;base64)?,[a-z0-9\\!\\$\\&\\'\\,\\(\\)\\*\\+\\,\\;\\=\\-\\.\\_\\~\\:\\@\\/\\?\\%\\s]*\\s*$/i;\n  arrImageStr = [];\n\n  do {\n    match = URLRegex.exec(svgStr);\n\n    if (match !== null) {\n      tmpImageStr = match[1];\n      tmpUrl = match[2];\n\n      if (!dataURIRegex.test(tmpUrl)) {\n        arrImageStr.push(tmpImageStr);\n      }\n    }\n  } while (match && match !== null);\n\n  return arrImageStr;\n},\n    removeImagesWithNonDataURL = function removeImagesWithNonDataURL(svgStrContent) {\n  var arrImageStr,\n      i,\n      currentImageStr,\n      svgStr = svgStrContent;\n  arrImageStr = extractNonDataImageFromSVG(svgStr);\n\n  for (i = 0; i < arrImageStr.length; i++) {\n    currentImageStr = arrImageStr[i];\n    svgStr = svgStr.replace(currentImageStr, \"\");\n  }\n\n  return svgStr;\n},\n    extractNonDataURLFromSVG = function extractNonDataURLFromSVG(svgStr, returnURLAsAbsolute) {\n  if (returnURLAsAbsolute === void 0) {\n    returnURLAsAbsolute = true;\n  }\n\n  var anyImageURLRegex, dataURIRegex, arrUrl, match, tmpUrl;\n  anyImageURLRegex = /<image [^\\>]*href=[\"']([^\\>'\"]*)[\"'][^\\>]*\\>/g;\n  dataURIRegex = /^\\s*data:([a-z]+\\/[a-z]+(;[a-z\\-]+\\=[a-z\\-]+)?)?(;base64)?,[a-z0-9\\!\\$\\&\\'\\,\\(\\)\\*\\+\\,\\;\\=\\-\\.\\_\\~\\:\\@\\/\\?\\%\\s]*\\s*$/i;\n  arrUrl = [];\n\n  do {\n    match = anyImageURLRegex.exec(svgStr);\n\n    if (match !== null) {\n      tmpUrl = match[1];\n\n      if (dataURIRegex.test(tmpUrl)) {\n        continue;\n      }\n\n      if (returnURLAsAbsolute) {\n        tmpUrl = parseUrl(tmpUrl).href;\n      }\n\n      arrUrl.push(tmpUrl);\n    }\n  } while (match && match !== null);\n\n  return arrUrl;\n},\n    parseUrl = function parseUrl(url) {\n  var div = document.createElement(\"div\");\n  div.innerHTML = \"<a></a>\";\n  div.firstChild.href = url;\n  div.innerHTML = div.innerHTML;\n  return div.firstChild;\n},\n    EXPORTACTION = {\n  DOWNLOAD: \"download\",\n  SAVE: \"save\",\n  DOWNLOADSAVE: \"download-save\"\n},\n    EXPORTMODE = {\n  CLIENT: \"client\",\n  SERVER: \"server\",\n  AUTO: \"auto\"\n},\n    EXPORTFORMAT = {\n  PNG: \"png\",\n  SVG: \"svg\",\n  JPEG: \"jpeg\",\n  JPG: \"jpg\",\n  PDF: \"pdf\",\n  XLSX: \"xlsx\",\n  CSV: \"csv\"\n},\n    LOGMODE = {\n  CLIENT: \"client\",\n  SERVER: \"server\",\n  AUTO: \"auto\"\n},\n    createExportActionOldString = function createExportActionOldString(exportAction) {\n  return {\n    download: EXPORTACTION.DOWNLOAD,\n    \"download-save\": EXPORTACTION.DOWNLOAD,\n    save: EXPORTACTION.SAVE\n  }[exportAction];\n},\n    objCacheFunctions = function () {\n  var imgCache, cacheAllImages, getImageCachedDetails, isCacheAllImagesCompleted;\n  imgCache = {};\n  imgCache.cacheCompleted = false;\n\n  cacheAllImages = function cacheAllImages(svgStr, noOP, callback) {\n    if (noOP === void 0) {\n      noOP = false;\n    }\n\n    var arrUrl, arrLength, countCompletedImages, i;\n    arrUrl = extractNonDataURLFromSVG(svgStr);\n    arrLength = arrUrl.length;\n\n    if ((0, _libSvgToCanvas.isCanvasElemSupported)() && !noOP && arrLength) {\n      countCompletedImages = 0;\n\n      for (i = 0; i < arrLength; i++) {\n        (function () {\n          var currentUrl, img;\n          currentUrl = arrUrl[i];\n\n          if (currentUrl in imgCache) {\n            countCompletedImages++;\n\n            if (arrLength === countCompletedImages) {\n              imgCache.cacheCompleted = true;\n              callback();\n            }\n\n            return;\n          }\n\n          img = new Image();\n          img.crossOrigin = _lib.BLANKSTRING;\n\n          img.onload = function () {\n            var canvas, imageUri;\n            canvas = document.createElement(\"canvas\");\n            canvas.width = img.width;\n            canvas.height = img.height;\n            canvas.getContext(\"2d\").drawImage(this, 0, 0);\n\n            try {\n              imageUri = canvas.toDataURL(\"image/png\");\n              imgCache[currentUrl] = {\n                loaded: true,\n                notCORS: true,\n                imageUri: imageUri\n              };\n            } catch (err) {\n              imgCache[currentUrl] = {\n                loaded: true,\n                notCORS: false\n              };\n            } finally {\n              countCompletedImages++;\n\n              if (arrLength === countCompletedImages) {\n                imgCache.cacheCompleted = true;\n                callback();\n              }\n            }\n          };\n\n          img.onerror = function () {\n            imgCache[currentUrl] = {\n              loaded: false\n            };\n            countCompletedImages++;\n\n            if (arrLength === countCompletedImages) {\n              imgCache.cacheCompleted = true;\n              callback();\n            }\n          };\n\n          img.src = currentUrl;\n        })();\n      }\n    } else {\n      callback();\n    }\n  };\n\n  getImageCachedDetails = function getImageCachedDetails(url) {\n    return imgCache[url];\n  };\n\n  isCacheAllImagesCompleted = function isCacheAllImagesCompleted() {\n    return imgCache.cacheCompleted;\n  };\n\n  return {\n    cacheAllImages: cacheAllImages,\n    getImageCachedDetails: getImageCachedDetails,\n    isCacheAllImagesCompleted: isCacheAllImagesCompleted\n  };\n}(),\n    cacheAllImages = objCacheFunctions.cacheAllImages,\n    getImageCachedDetails = objCacheFunctions.getImageCachedDetails,\n    isCacheAllImagesCompleted = objCacheFunctions.isCacheAllImagesCompleted,\n    replaceImageToAbsoluteValue = function replaceImageToAbsoluteValue(matchStr) {\n  matchStr = matchStr.replace(/(:href=\")([^\"]*)(\")/gi, function (matchSubStr, p1, p2, p3) {\n    return p1 + parseUrl(p2).href + p3;\n  });\n  return matchStr;\n},\n    makeImageUrlsAbsolute = function makeImageUrlsAbsolute(svgStr) {\n  return svgStr.replace(/<image [^\\>]*\\>/gi, replaceImageToAbsoluteValue);\n},\n    embedImagesWithNonDataURL = function embedImagesWithNonDataURL(svgStrInput) {\n  var arrURL,\n      i,\n      currentURL,\n      currentURLDetails,\n      svgStr = makeImageUrlsAbsolute(svgStrInput);\n  arrURL = extractNonDataURLFromSVG(svgStr);\n\n  for (i = 0; i < arrURL.length; i++) {\n    currentURL = arrURL[i];\n    currentURLDetails = getImageCachedDetails(currentURL);\n\n    if (currentURLDetails !== _lib.UNDEF && currentURLDetails.loaded && currentURLDetails.notCORS && currentURLDetails.imageUri) {\n      svgStr = svgStr.replace(currentURL, currentURLDetails.imageUri);\n    }\n  }\n\n  return svgStr;\n},\n    replaceImagesWithNonDataUrl = function replaceImagesWithNonDataUrl(svgStr) {\n  return removeImagesWithNonDataURL(embedImagesWithNonDataURL(svgStr));\n},\n    hasUndownloadableImage = function hasUndownloadableImage(svgStrInput) {\n  var svgStr = embedImagesWithNonDataURL(svgStrInput);\n  return svgStr !== removeImagesWithNonDataURL(svgStr);\n},\n    logChartsWithoutCheck = function logChartsWithoutCheck(postData, options) {\n  var ajaxLog = new _ajax.default(_lib.stubFN, _lib.stubFN);\n\n  for (var item in postData) {\n    postData.hasOwnProperty(item) && (postData[item] = encodeURIComponent(postData[item]));\n  }\n\n  ajaxLog.post(options.logHandler, postData);\n},\n    logCharts = function logCharts(postData, options) {\n  if (options.logEnabled && options.logMode !== LOGMODE.SERVER) {\n    logChartsWithoutCheck(postData, options);\n  }\n},\n    addSVGHeader = function addSVGHeader(svgStr) {\n  return '<?xml version=\"1.0\" standalone=\"no\"?>\\n      <!DOCTYPE svg PUBLIC \"-//W3C//DTD SVG 1.1//EN\"\\n       \"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\"> ' + svgStr;\n},\n    svgStrToDataUrl = function svgStrToDataUrl(svgStr) {\n  var finalSvgStr = addSVGHeader(svgStr);\n  finalSvgStr = \"data:image/svg+xml;base64,\" + window.btoa(window.unescape(encodeURIComponent(finalSvgStr)));\n  return finalSvgStr;\n};\n\nexports.svgStrToDataUrl = svgStrToDataUrl;\nexports.logCharts = logCharts;\nexports.hasUndownloadableImage = hasUndownloadableImage;\nexports.replaceImagesWithNonDataUrl = replaceImagesWithNonDataUrl;\nexports.embedImagesWithNonDataURL = embedImagesWithNonDataURL;\nexports.makeImageUrlsAbsolute = makeImageUrlsAbsolute;\nexports.isCacheAllImagesCompleted = isCacheAllImagesCompleted;\nexports.getImageCachedDetails = getImageCachedDetails;\nexports.cacheAllImages = cacheAllImages;\nexports.objCacheFunctions = objCacheFunctions;\nexports.createExportActionOldString = createExportActionOldString;\nexports.LOGMODE = LOGMODE;\nexports.EXPORTFORMAT = EXPORTFORMAT;\nexports.EXPORTMODE = EXPORTMODE;\nexports.EXPORTACTION = EXPORTACTION;\nexports.parseUrl = parseUrl;\nexports.extractNonDataURLFromSVG = extractNonDataURLFromSVG;\nexports.removeImagesWithNonDataURL = removeImagesWithNonDataURL;\nexports.extractNonDataImageFromSVG = extractNonDataImageFromSVG;","map":{"version":3,"sources":["C:/Users/moham/OneDrive/Desktop/04_06_2021/henaknowledge/frontend v3/henaknowledgefrontend/node_modules/@fusioncharts/features/src/utils/export-utils.js"],"names":["_interopRequireDefault","require","exports","__esModule","svgStrToDataUrl","logCharts","extractNonDataImageFromSVG","parseUrl","extractNonDataURLFromSVG","removeImagesWithNonDataURL","hasUndownloadableImage","replaceImagesWithNonDataUrl","embedImagesWithNonDataURL","makeImageUrlsAbsolute","isCacheAllImagesCompleted","getImageCachedDetails","cacheAllImages","objCacheFunctions","createExportActionOldString","LOGMODE","EXPORTFORMAT","EXPORTMODE","EXPORTACTION","_libSvgToCanvas","_ajax","_lib","svgStr","URLRegex","dataURIRegex","arrImageStr","match","tmpImageStr","tmpUrl","exec","test","push","svgStrContent","i","currentImageStr","length","replace","returnURLAsAbsolute","anyImageURLRegex","arrUrl","href","url","div","document","createElement","innerHTML","firstChild","DOWNLOAD","SAVE","DOWNLOADSAVE","CLIENT","SERVER","AUTO","PNG","SVG","JPEG","JPG","PDF","XLSX","CSV","exportAction","download","save","imgCache","cacheCompleted","noOP","callback","arrLength","countCompletedImages","isCanvasElemSupported","currentUrl","img","Image","crossOrigin","BLANKSTRING","onload","canvas","imageUri","width","height","getContext","drawImage","toDataURL","loaded","notCORS","err","onerror","src","replaceImageToAbsoluteValue","matchStr","matchSubStr","p1","p2","p3","svgStrInput","arrURL","currentURL","currentURLDetails","UNDEF","logChartsWithoutCheck","postData","options","ajaxLog","default","stubFN","item","hasOwnProperty","encodeURIComponent","post","logHandler","logEnabled","logMode","addSVGHeader","finalSvgStr","window","btoa","unescape"],"mappings":"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","sourcesContent":["\"use strict\";var _interopRequireDefault=require(\"@babel/runtime/helpers/interopRequireDefault\");exports.__esModule=true;exports.svgStrToDataUrl=exports.logCharts=exports.extractNonDataImageFromSVG=exports.parseUrl=exports.extractNonDataURLFromSVG=exports.removeImagesWithNonDataURL=exports.hasUndownloadableImage=exports.replaceImagesWithNonDataUrl=exports.embedImagesWithNonDataURL=exports.makeImageUrlsAbsolute=exports.isCacheAllImagesCompleted=exports.getImageCachedDetails=exports.cacheAllImages=exports.objCacheFunctions=exports.createExportActionOldString=exports.LOGMODE=exports.EXPORTFORMAT=exports.EXPORTMODE=exports.EXPORTACTION=void 0;var _libSvgToCanvas=require(\"./lib-svg-to-canvas\");var _ajax=_interopRequireDefault(require(\"@fusioncharts/core/src/ajax\"));var _lib=require(\"@fusioncharts/core/src/lib\");var extractNonDataImageFromSVG=function extractNonDataImageFromSVG(svgStr){var URLRegex,dataURIRegex,arrImageStr,match,tmpImageStr,tmpUrl;URLRegex=/(<image [^\\>]*href=[\"']([^\\>'\"]*)[\"'][^\\>]*\\>)/g;dataURIRegex=/^\\s*data:([a-z]+\\/[a-z]+(;[a-z\\-]+\\=[a-z\\-]+)?)?(;base64)?,[a-z0-9\\!\\$\\&\\'\\,\\(\\)\\*\\+\\,\\;\\=\\-\\.\\_\\~\\:\\@\\/\\?\\%\\s]*\\s*$/i;arrImageStr=[];do{match=URLRegex.exec(svgStr);if(match!==null){tmpImageStr=match[1];tmpUrl=match[2];if(!dataURIRegex.test(tmpUrl)){arrImageStr.push(tmpImageStr)}}}while(match&&match!==null);return arrImageStr},removeImagesWithNonDataURL=function removeImagesWithNonDataURL(svgStrContent){var arrImageStr,i,currentImageStr,svgStr=svgStrContent;arrImageStr=extractNonDataImageFromSVG(svgStr);for(i=0;i<arrImageStr.length;i++){currentImageStr=arrImageStr[i];svgStr=svgStr.replace(currentImageStr,\"\")}return svgStr},extractNonDataURLFromSVG=function extractNonDataURLFromSVG(svgStr,returnURLAsAbsolute){if(returnURLAsAbsolute===void 0){returnURLAsAbsolute=true}var anyImageURLRegex,dataURIRegex,arrUrl,match,tmpUrl;anyImageURLRegex=/<image [^\\>]*href=[\"']([^\\>'\"]*)[\"'][^\\>]*\\>/g;dataURIRegex=/^\\s*data:([a-z]+\\/[a-z]+(;[a-z\\-]+\\=[a-z\\-]+)?)?(;base64)?,[a-z0-9\\!\\$\\&\\'\\,\\(\\)\\*\\+\\,\\;\\=\\-\\.\\_\\~\\:\\@\\/\\?\\%\\s]*\\s*$/i;arrUrl=[];do{match=anyImageURLRegex.exec(svgStr);if(match!==null){tmpUrl=match[1];if(dataURIRegex.test(tmpUrl)){continue}if(returnURLAsAbsolute){tmpUrl=parseUrl(tmpUrl).href}arrUrl.push(tmpUrl)}}while(match&&match!==null);return arrUrl},parseUrl=function parseUrl(url){var div=document.createElement(\"div\");div.innerHTML=\"<a></a>\";div.firstChild.href=url;div.innerHTML=div.innerHTML;return div.firstChild},EXPORTACTION={DOWNLOAD:\"download\",SAVE:\"save\",DOWNLOADSAVE:\"download-save\"},EXPORTMODE={CLIENT:\"client\",SERVER:\"server\",AUTO:\"auto\"},EXPORTFORMAT={PNG:\"png\",SVG:\"svg\",JPEG:\"jpeg\",JPG:\"jpg\",PDF:\"pdf\",XLSX:\"xlsx\",CSV:\"csv\"},LOGMODE={CLIENT:\"client\",SERVER:\"server\",AUTO:\"auto\"},createExportActionOldString=function createExportActionOldString(exportAction){return{download:EXPORTACTION.DOWNLOAD,\"download-save\":EXPORTACTION.DOWNLOAD,save:EXPORTACTION.SAVE}[exportAction]},objCacheFunctions=function(){var imgCache,cacheAllImages,getImageCachedDetails,isCacheAllImagesCompleted;imgCache={};imgCache.cacheCompleted=false;cacheAllImages=function cacheAllImages(svgStr,noOP,callback){if(noOP===void 0){noOP=false}var arrUrl,arrLength,countCompletedImages,i;arrUrl=extractNonDataURLFromSVG(svgStr);arrLength=arrUrl.length;if((0,_libSvgToCanvas.isCanvasElemSupported)()&&!noOP&&arrLength){countCompletedImages=0;for(i=0;i<arrLength;i++){(function(){var currentUrl,img;currentUrl=arrUrl[i];if(currentUrl in imgCache){countCompletedImages++;if(arrLength===countCompletedImages){imgCache.cacheCompleted=true;callback()}return}img=new Image;img.crossOrigin=_lib.BLANKSTRING;img.onload=function(){var canvas,imageUri;canvas=document.createElement(\"canvas\");canvas.width=img.width;canvas.height=img.height;canvas.getContext(\"2d\").drawImage(this,0,0);try{imageUri=canvas.toDataURL(\"image/png\");imgCache[currentUrl]={loaded:true,notCORS:true,imageUri:imageUri}}catch(err){imgCache[currentUrl]={loaded:true,notCORS:false}}finally{countCompletedImages++;if(arrLength===countCompletedImages){imgCache.cacheCompleted=true;callback()}}};img.onerror=function(){imgCache[currentUrl]={loaded:false};countCompletedImages++;if(arrLength===countCompletedImages){imgCache.cacheCompleted=true;callback()}};img.src=currentUrl})()}}else{callback()}};getImageCachedDetails=function getImageCachedDetails(url){return imgCache[url]};isCacheAllImagesCompleted=function isCacheAllImagesCompleted(){return imgCache.cacheCompleted};return{cacheAllImages:cacheAllImages,getImageCachedDetails:getImageCachedDetails,isCacheAllImagesCompleted:isCacheAllImagesCompleted}}(),cacheAllImages=objCacheFunctions.cacheAllImages,getImageCachedDetails=objCacheFunctions.getImageCachedDetails,isCacheAllImagesCompleted=objCacheFunctions.isCacheAllImagesCompleted,replaceImageToAbsoluteValue=function replaceImageToAbsoluteValue(matchStr){matchStr=matchStr.replace(/(:href=\")([^\"]*)(\")/gi,(function(matchSubStr,p1,p2,p3){return p1+parseUrl(p2).href+p3}));return matchStr},makeImageUrlsAbsolute=function makeImageUrlsAbsolute(svgStr){return svgStr.replace(/<image [^\\>]*\\>/gi,replaceImageToAbsoluteValue)},embedImagesWithNonDataURL=function embedImagesWithNonDataURL(svgStrInput){var arrURL,i,currentURL,currentURLDetails,svgStr=makeImageUrlsAbsolute(svgStrInput);arrURL=extractNonDataURLFromSVG(svgStr);for(i=0;i<arrURL.length;i++){currentURL=arrURL[i];currentURLDetails=getImageCachedDetails(currentURL);if(currentURLDetails!==_lib.UNDEF&&currentURLDetails.loaded&&currentURLDetails.notCORS&&currentURLDetails.imageUri){svgStr=svgStr.replace(currentURL,currentURLDetails.imageUri)}}return svgStr},replaceImagesWithNonDataUrl=function replaceImagesWithNonDataUrl(svgStr){return removeImagesWithNonDataURL(embedImagesWithNonDataURL(svgStr))},hasUndownloadableImage=function hasUndownloadableImage(svgStrInput){var svgStr=embedImagesWithNonDataURL(svgStrInput);return svgStr!==removeImagesWithNonDataURL(svgStr)},logChartsWithoutCheck=function logChartsWithoutCheck(postData,options){var ajaxLog=new _ajax.default(_lib.stubFN,_lib.stubFN);for(var item in postData){postData.hasOwnProperty(item)&&(postData[item]=encodeURIComponent(postData[item]))}ajaxLog.post(options.logHandler,postData)},logCharts=function logCharts(postData,options){if(options.logEnabled&&options.logMode!==LOGMODE.SERVER){logChartsWithoutCheck(postData,options)}},addSVGHeader=function addSVGHeader(svgStr){return'<?xml version=\"1.0\" standalone=\"no\"?>\\n      <!DOCTYPE svg PUBLIC \"-//W3C//DTD SVG 1.1//EN\"\\n       \"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\"> '+svgStr},svgStrToDataUrl=function svgStrToDataUrl(svgStr){var finalSvgStr=addSVGHeader(svgStr);finalSvgStr=\"data:image/svg+xml;base64,\"+window.btoa(window.unescape(encodeURIComponent(finalSvgStr)));return finalSvgStr};exports.svgStrToDataUrl=svgStrToDataUrl;exports.logCharts=logCharts;exports.hasUndownloadableImage=hasUndownloadableImage;exports.replaceImagesWithNonDataUrl=replaceImagesWithNonDataUrl;exports.embedImagesWithNonDataURL=embedImagesWithNonDataURL;exports.makeImageUrlsAbsolute=makeImageUrlsAbsolute;exports.isCacheAllImagesCompleted=isCacheAllImagesCompleted;exports.getImageCachedDetails=getImageCachedDetails;exports.cacheAllImages=cacheAllImages;exports.objCacheFunctions=objCacheFunctions;exports.createExportActionOldString=createExportActionOldString;exports.LOGMODE=LOGMODE;exports.EXPORTFORMAT=EXPORTFORMAT;exports.EXPORTMODE=EXPORTMODE;exports.EXPORTACTION=EXPORTACTION;exports.parseUrl=parseUrl;exports.extractNonDataURLFromSVG=extractNonDataURLFromSVG;exports.removeImagesWithNonDataURL=removeImagesWithNonDataURL;exports.extractNonDataImageFromSVG=extractNonDataImageFromSVG;"]},"metadata":{},"sourceType":"script"}